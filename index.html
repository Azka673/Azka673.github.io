<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ocean RNG - v29 Expansion Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #05050a; --primary: #00d2d3; --accent: #ff9f43;
            --glass: rgba(255, 255, 255, 0.03); --glass-heavy: rgba(0, 0, 0, 0.9);
            --border: rgba(255, 255, 255, 0.1);
            --common: #aab; --rare: #2e86de; --epic: #8e44ad; 
            --legendary: #f1c40f; --mythic: #e74c3c; --secret: #fd79a8;
            --ancient: linear-gradient(45deg, #ff0000, #ffff00, #00ff00, #00ffff, #0000ff, #ff00ff);
        }

        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Inter', sans-serif; background: var(--bg); color: #fff; overflow: hidden; }

        #main-menu {
            position: fixed; inset: 0; background: radial-gradient(circle at center, #0a1a2f 0%, #05050a 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; transition: 0.8s;
        }
        .menu-title { font-size: clamp(40px, 10vw, 80px); font-weight: 900; letter-spacing: -2px; background: linear-gradient(to bottom, #fff, #444); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        .layout { display: flex; height: 100vh; }
        .sidebar { width: 260px; background: var(--glass-heavy); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 20px; z-index: 10; gap: 8px; }
        .content { flex: 1; overflow-y: auto; padding: 40px; padding-bottom: 150px; position: relative; }

        .card { background: var(--glass); border: 1px solid var(--border); border-radius: 12px; padding: 15px; }
        .btn { background: var(--glass); border: 1px solid var(--border); color: #fff; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: 600; text-align: left; transition: 0.2s; display: flex; align-items: center; gap: 10px; width: 100%; }
        .btn:hover { background: var(--primary); color: #000; }
        .btn.active { background: var(--primary); color: #000; }

        .bar-track { width: 100%; height: 50px; background: #000; border-radius: 25px; position: relative; overflow: hidden; border: 2px solid #222; margin: 25px 0; }
        .green-zone { height: 100%; background: var(--primary); position: absolute; box-shadow: 0 0 25px var(--primary); transition: 0.1s; }
        .pointer { width: 6px; height: 100%; background: #fff; position: absolute; z-index: 5; box-shadow: 0 0 15px #fff; }

        .play-btn { padding: 15px 40px; font-size: 18px; font-weight: bold; background: var(--primary); border: none; border-radius: 10px; cursor: pointer; transition: 0.2s; color: #000; width: 100%; text-transform: uppercase; }
        .play-btn.reeling { background: #ff4757; color: #fff; }

        .quest-box, .upgrade-box { background: var(--glass); border: 1px solid var(--border); border-radius: 15px; padding: 20px; margin-bottom: 15px; }
        .progress-container { height: 10px; background: rgba(255,255,255,0.05); border-radius: 5px; overflow: hidden; margin-top: 10px; }
        .progress-bar { height: 100%; background: var(--primary); width: 0%; transition: 0.5s; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 12px; }
        .item-box { background: var(--glass); border: 1px solid var(--border); border-radius: 12px; padding: 15px; text-align: center; font-size: 12px; }
        .locked { opacity: 0.2; filter: grayscale(1); }

        .weather-hud { position: fixed; bottom: 25px; right: 25px; padding: 15px 25px; background: rgba(0,0,0,0.85); border: 2px solid var(--primary); border-radius: 15px; text-align: right; z-index: 100; }
        #toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: var(--primary); color: #000; padding: 10px 25px; border-radius: 50px; font-weight: bold; opacity: 0; transition: 0.4s; z-index: 2000; pointer-events: none; }
        .txt-ancient { background: var(--ancient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 900; }
        
        @keyframes zoomIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>

<div id="toast">Notifikasi</div>

<div id="main-menu">
    <div class="menu-title">OCEAN RNG</div>
    <div style="color: var(--primary); letter-spacing: 4px; margin-bottom: 30px; font-weight: bold;">v29.0 THE EXPANSION</div>
    <button class="play-btn" style="width: auto;" onclick="ui.startGame()">MULAI PETUALANGAN</button>
</div>

<div class="layout">
    <aside class="sidebar">
        <div style="font-weight: 900; color: var(--primary); text-align:center; margin-bottom: 15px; font-size: 20px;">DASHBOARD</div>
        <div class="card" style="margin-bottom: 10px;">
            <small style="color: #666;">SALDO</small>
            <div id="money" style="font-size: 20px; color: var(--legendary); font-weight: bold;">üí∞ 0</div>
        </div>
        <button class="btn active" onclick="ui.tab('fishing', this)">üé£ Memancing</button>
        <button class="btn" onclick="ui.tab('quests', this)">üéØ Misi Khusus</button>
        <button class="btn" onclick="ui.tab('upgrades', this)">‚öôÔ∏è Upgrade Lab</button>
        <button class="btn" onclick="ui.tab('inventory', this)">üéí Tas (<span id="inv-count">0</span>)</button>
        <button class="btn" onclick="ui.tab('shop', this)">üõí Toko Rod</button>
        <button class="btn" onclick="ui.tab('index', this)">üìñ Index</button>
        <div style="margin-top:auto;"><button onclick="game.reset()" style="background:none; border:none; color:#333; font-size:10px; cursor:pointer;">RESET PROGRESS</button></div>
    </aside>

    <main class="content">
        <section id="tab-fishing">
            <div style="max-width: 600px; margin: 0 auto; text-align: center;">
                <h1 id="rod-display" style="margin: 0; font-size: 32px; color: var(--primary);">WOOD ROD</h1>
                <div id="rod-stats" style="color: #666; margin-bottom: 15px; font-size: 14px;">Boost Luck: +0%</div>
                <div class="bar-track">
                    <div class="green-zone" id="green-zone"></div>
                    <div class="pointer" id="pointer"></div>
                </div>
                <button id="catch-btn" class="play-btn" onclick="game.handleAction()">STRIKE! (SPACE)</button>
                <div id="catch-result" style="margin-top: 30px; min-height: 120px;"></div>
            </div>
        </section>

        <section id="tab-quests" style="display:none;">
            <h1>Misi Khusus Zenith</h1>
            <p style="color:#666; margin-bottom:20px;">Selesaikan misi ini untuk mendapatkan Rod terkuat di dunia.</p>
            <div id="quest-container"></div>
            <div id="claim-area" style="margin-top:20px;"></div>
        </section>

        <section id="tab-upgrades" style="display:none;">
            <h1>Laboratorium Mekanik</h1>
            <div id="upgrade-container"></div>
        </section>

        <section id="tab-inventory" style="display:none;">
            <div style="display:flex; justify-content:space-between; align-items: center; margin-bottom: 20px;">
                <h1>Penyimpanan Ikan</h1>
                <button class="play-btn" style="width:auto; padding: 10px 25px;" onclick="game.sellAll()">JUAL SEMUA</button>
            </div>
            <div id="inv-grid" class="grid"></div>
        </section>

        <section id="tab-shop" style="display:none;">
            <h1>Toko Alat Pancing</h1>
            <div id="shop-grid" class="grid"></div>
        </section>

        <section id="tab-index" style="display:none;">
            <h1>Discovery Index</h1>
            <div id="index-grid" class="grid"></div>
        </section>
    </main>

    <div class="weather-hud">
        <div id="w-name" style="font-size: 20px; font-weight: bold;">‚òÄÔ∏è Cerah</div>
        <div id="w-stats" style="font-size: 12px; color: var(--primary);">Luck x1.0 | Money x1.0</div>
    </div>
</div>

<script>
const CONFIG = {
    pity: { common: 2, rare: 10, epic: 60, legendary: 350, mythic: 1800, secret: 15000, ancient: 80000 },
    
    // 15 WEATHER VARIATIONS
    weather: [
        { name: "‚òÄÔ∏è Cerah", luck: 1.0, money: 1.0 },
        { name: "üåßÔ∏è Hujan", luck: 1.6, money: 1.2 },
        { name: "üåë Gerhana", luck: 5.0, money: 0.8 },
        { name: "üåà Pelangi", luck: 4.0, money: 2.0 },
        { name: "üåï Bulan Darah", luck: 12.0, money: 0.1 },
        { name: "‚ö° Badai Petir", luck: 2.5, money: 1.3 },
        { name: "‚ùÑÔ∏è Salju", luck: 1.8, money: 1.1 },
        { name: "üå´Ô∏è Kabut Tebal", luck: 3.2, money: 0.9 },
        { name: "‚òÑÔ∏è Hujan Meteor", luck: 8.5, money: 0.5 },
        { name: "üåä Tsunami", luck: 6.0, money: 1.5 },
        { name: "üåå Stellar Alignment", luck: 15.0, money: 1.0 },
        { name: "üß™ Hujan Toksik", luck: 2.2, money: 3.0 },
        { name: "üèúÔ∏è Badai Pasir", luck: 2.8, money: 0.7 },
        { name: "üå∏ Sakura", luck: 3.5, money: 1.8 },
        { name: "üî• Heatwave", luck: 1.2, money: 2.5 }
    ],

    // 15 RODS (Balanced under 10M)
    rods: {
        wood: { name: "Wood Rod", boost: 0, price: 0 },
        rusty: { name: "Rusty Hook", boost: 50, price: 500 },
        bamboo: { name: "Bamboo Pole", boost: 150, price: 2000 },
        fiber: { name: "Glass Fiber", boost: 400, price: 8000 },
        carbon: { name: "Carbon Fiber", boost: 800, price: 25000 },
        steel: { name: "Hard Steel", boost: 1500, price: 75000 },
        gold: { name: "Golden Hook", boost: 3500, price: 200000 },
        emerald: { name: "Emerald Rod", boost: 6000, price: 500000 },
        diamond: { name: "Diamond Caster", boost: 12000, price: 1200000 },
        plasma: { name: "Plasma Coil", boost: 25000, price: 2500000 },
        nebula: { name: "Nebula Reach", boost: 45000, price: 4000000 },
        abyss: { name: "Abyssal Anchor", boost: 80000, price: 6500000 },
        kraken: { name: "Kraken Tentacle", boost: 150000, price: 8000000 },
        poseidon: { name: "Poseidon's Wrath", boost: 250000, price: 9500000 },
        zenith: { name: "Zenith Legend üëë", boost: 1000000, price: -1 }
    },

    fish: [
        {name:"Plastik", r:"common", price:1, icon:"üìÅ"},
        {name:"Sepatu Bekas",r:"common",price:3,icon:"üóëÔ∏è"},
        { name: "Pebble", r: "common", price: 1, icon: "ü™®" },
        { name: "Stick", r: "common", price: 1, icon: "ü•¢" },
        { name: "Rusty Nail", r: "common", price: 2, icon: "üìç" },
        { name: "Old Rag", r: "common", price: 2, icon: "üßπ" },
        { name: "Dirt Clod", r: "common", price: 1, icon: "üí©" },
        { name: "Glass Shard", r: "common", price: 3, icon: "üíé" },
        { name: "Apple Core", r: "common", price: 2, icon: "üçè" },
        { name: "Bent Fork", r: "common", price: 4, icon: "üç¥" },
        { name: "Dull Knife", r: "common", price: 5, icon: "üî™" },
        { name: "Broken Brick", r: "common", price: 3, icon: "üß±" },
        { name: "Cotton Thread", r: "common", price: 2, icon: "üßµ" },
        { name: "Dried Leaf", r: "common", price: 1, icon: "üçÇ" },
        { name: "Empty Bottle", r: "common", price: 4, icon: "üß™" },
        { name: "Feather", r: "common", price: 3, icon: "ü™∂" },
        { name: "Fish Bone", r: "common", price: 2, icon: "ü¶¥" },
        {name:"Sarden", r:"common", price:2, icon:"üêü"},
        {name:"Tuna Biru", r:"rare", price:10, icon:"üê†"},
        { name: "Silver Sword", r: "rare", price: 45, icon: "‚öîÔ∏è" },
        { name: "Iron Shield", r: "rare", price: 30, icon: "üõ°Ô∏è" },
        { name: "Steel Boots", r: "rare", price: 25, icon: "üë¢" },
        { name: "Magic Potion", r: "rare", price: 15, icon: "üß™" },
        { name: "Leather Tunic", r: "rare", price: 20, icon: "üëï" },
        { name: "Oak Bow", r: "rare", price: 55, icon: "üèπ" },
        { name: "Bronze Ring", r: "rare", price: 12, icon: "üíç" },
        { name: "Mana Crystal", r: "rare", price: 65, icon: "üîÆ" },
        { name: "Wind Cape", r: "rare", price: 40, icon: "üß£" },
        { name: "Fire Scroll", r: "rare", price: 35, icon: "üìú" },
        { name: "Swift Dagger", r: "rare", price: 28, icon: "üó°Ô∏è" },
        { name: "Heavy Helm", r: "rare", price: 50, icon: "ü™ñ" },
        { name: "Light Stone", r: "rare", price: 18, icon: "üïØÔ∏è" },
        { name: "Wolf Fang", r: "rare", price: 22, icon: "ü¶¥" },
        { name: "Eagle Eye", r: "rare", price: 70, icon: "üëÅÔ∏è" },
        { name: "Frost Gem", r: "rare", price: 48, icon: "üíé" },
        { name: "Thunder Horn", r: "rare", price: 75, icon: "üì¢" },
        { name: "Shadow Mask", r: "rare", price: 60, icon: "üé≠" },
        { name: "Nature Staff", r: "rare", price: 42, icon: "ü™Ñ" },
        { name: "Gold Coin Bag", r: "rare", price: 10, icon: "üí∞" },
        {name:"Hiu Biru", r:"epic", price:50, icon:"ü¶à"},
        {name:"Lumba-Lumba",r:"epic",price:70,icon:"üê¨"},
        { name: "Night Mare", r: "epic", price: 275, icon: "üêé" },
        { name: "Abyss Watcher", r: "epic", price: 320, icon: "üëÅÔ∏è" },
        { name: "Storm Bringer", r: "epic", price: 450, icon: "üå™Ô∏è" },
        { name: "Magma Core", r: "epic", price: 210, icon: "üî•" },
        { name: "Ancient Relic", r: "epic", price: 380, icon: "üè∫" },
        { name: "Cyber Samurai", r: "epic", price: 490, icon: "‚öîÔ∏è" },
        { name: "Venom Fang", r: "epic", price: 240, icon: "üß™" },
        { name: "Lunar Wing", r: "epic", price: 365, icon: "üåô" },
        { name: "Solar Flare", r: "epic", price: 430, icon: "‚òÄÔ∏è" },
        { name: "Ghost Ship", r: "epic", price: 315, icon: "üö¢" },
        {name:"Megalodon", r:"legendary", price:250, icon:"ü¶à"},
        {name:"brinjinji", r:"mythic", price:1200, icon:"üåÄ"},
        {name:"Nawwaf BDF",r:"mythic", price:1500, icon:"69"},
        { name: "Celestial Dragon", r: "mythic", price: 2850, icon: "üê≤" },
        { name: "Eternal Flame", r: "mythic", price: 1500, icon: "üî•" },
        { name: "Void Monarch", r: "mythic", price: 2100, icon: "üëë" },
        { name: "Star Forge", r: "mythic", price: 1350, icon: "‚ú®" },
        { name: "Nebula Reaper", r: "mythic", price: 2700, icon: "üíÄ" },
        { name: "Divine Aegis", r: "mythic", price: 1950, icon: "üõ°Ô∏è" },
        { name: "Time Warp", r: "mythic", price: 2400, icon: "‚è≥" },
        {name:"Rafa 67", r:"secret", price:8000, icon:"üíé"},
        { name: "Reality Breaker", r: "secret", price: 11500, icon: "üåÄ" },
        { name: "Soul Devourer", r: "secret", price: 9200, icon: "üßø" },
        { name: "Infinite Singularity", r: "secret", price: 10800, icon: "üï≥Ô∏è" },
        { name: "Genesis Core", r: "secret", price: 8400, icon: "üíé" },
        { name: "Cursed Relic", r: "secret", price: 9750, icon: "üóø" },
        { name: "God Slayer", r: "secret", price: 11900, icon: "‚öîÔ∏è" },
        { name: "Astral Projection", r: "secret", price: 8100, icon: "üåå" },
        { name: "Dark Matter", r: "secret", price: 10200, icon: "üåë" },
        { name: "Omega Protocol", r: "secret", price: 11300, icon: "üß¨" },
        { name: "Ancient Deity", r: "secret", price: 8900, icon: "üî±" },
        {name:"Ancient Longness",r:"secret",price:9000,icon:"üêâ"},
        {name:"El Ketua Zahid", r:"ancient", price:10000,icon:"67"},
        { name: "Elder Titan", r: "ancient", price: 28500, icon: "üèîÔ∏è" },
        { name: "Primordial Sun", r: "ancient", price: 15400, icon: "üîÜ" },
        { name: "World Tree Seed", r: "ancient", price: 21200, icon: "üå±" },
        { name: "Chronos Key", r: "ancient", price: 12800, icon: "üîë" },
        { name: "Eternal Monolith", r: "ancient", price: 19700, icon: "üß±" },
        { name: "Ancestral Spirit", r: "ancient", price: 24300, icon: "üëª" },
        { name: "Lost Continent", r: "ancient", price: 29900, icon: "üó∫Ô∏è" },
        { name: "Origin Blade", r: "ancient", price: 17600, icon: "üó°Ô∏è" },
        { name: "Dragon Soul", r: "ancient", price: 26100, icon: "üèÆ" },
        { name: "Forgotten King", r: "ancient", price: 11200, icon: "üëë" },
        {name:"THE ONE PIECE", r:"ancient", price:50000, icon:"üè¥‚Äç‚ò†Ô∏è"}
    ],

    ranks: {
        common: { color: '#aab', size: 1.0 },
        rare: { color: '#2e86de', size: 0.85 },
        epic: { color: '#8e44ad', size: 0.75 },
        legendary: { color: '#f1c40f', size: 0.6 },
        mythic: { color: '#e74c3c', size: 0.5 },
        secret: { color: '#fd79a8', size: 0.35 },
        ancient: { color: '#fff', size: 0.22 }
    }
};

let state = {
    money: 0, inventory: [], found: [], ownedRods: ['wood'], equipped: 'wood',
    upgrades: { slower: 0, bigger: 0 },
    qNormal: 0, qSecret: 0, qAncient: 0, qClaimed: false
};

let curW = 0; let barPos = 0; let barDir = 1; 
let isMoving = false; let isReeling = false;
let pendingFish = null;

const game = {
    init: () => {
        const saved = localStorage.getItem('oceanRNG_v29');
        if(saved) state = JSON.parse(saved);
        setInterval(game.weatherCycle, 45000); // Ganti cuaca tiap 45 detik
        game.weatherCycle();
        game.loop();
        ui.update();
    },
    weatherCycle: () => {
        curW = Math.floor(Math.random() * CONFIG.weather.length);
        ui.update();
    },
    handleAction: () => {
        if(!isMoving) return;
        const gz = document.getElementById('green-zone');
        const hit = barPos >= parseFloat(gz.style.left) && barPos <= (parseFloat(gz.style.left) + parseFloat(gz.style.width));
        const btn = document.getElementById('catch-btn');

        if(!isReeling) {
            if(hit) {
                isReeling = true;
                pendingFish = game.rollFish();
                btn.innerText = "REELING... (SPACE)";
                btn.classList.add('reeling');
                
                // DYNAMIC DIFFICULTY
                let baseWidth = 15 + (state.upgrades.bigger * 2.5);
                let rarityScale = CONFIG.ranks[pendingFish.r].size;
                gz.style.width = (baseWidth * rarityScale) + '%';
                gz.style.left = Math.random() * (100 - parseFloat(gz.style.width)) + '%';
            } else { game.fail(); }
        } else {
            if(hit) game.success(); else game.fail();
            isReeling = false;
            btn.innerText = "STRIKE! (SPACE)";
            btn.classList.remove('reeling');
        }
    },
    rollFish: () => {
        const rod = CONFIG.rods[state.equipped];
        const w = CONFIG.weather[curW];
        const totalLuck = 2 * (1 + (rod.boost / 100)) * w.luck;
        const rarityOrder = ['ancient', 'secret', 'mythic', 'legendary', 'epic', 'rare', 'common'];
        for(let r of rarityOrder) {
            if(Math.random() < 1 / (CONFIG.pity[r] / totalLuck)) {
                const pool = CONFIG.fish.filter(f => f.r === r);
                return pool[Math.floor(Math.random()*pool.length)];
            }
        }
        return CONFIG.fish[0];
    },
    success: () => {
        isMoving = false;
        state.inventory.push(pendingFish);
        if(!state.found.includes(pendingFish.name)) state.found.push(pendingFish.name);
        
        // Update Quest
        if(pendingFish.r === 'common' || pendingFish.r === 'rare') state.qNormal = Math.min(500, state.qNormal + 1);
        if(pendingFish.r === 'secret') state.qSecret = Math.min(250, state.qSecret + 1);
        if(pendingFish.r === 'ancient') state.qAncient = Math.min(100, state.qAncient + 1);

        ui.showResult(pendingFish);
        setTimeout(() => { isMoving = true; ui.update(); game.save(); }, 1200);
    },
    fail: () => {
        isMoving = false;
        ui.showResult(null);
        setTimeout(() => { isMoving = true; ui.update(); }, 800);
    },
    sellAll: () => {
        let total = state.inventory.reduce((s, f) => s + (f.price * CONFIG.weather[curW].money), 0);
        state.money += total; state.inventory = [];
        ui.toast(`üí∞ +${Math.floor(total).toLocaleString()}`);
        ui.update(); ui.renderInv(); game.save();
    },
    upgrade: (type) => {
        let cost = (state.upgrades[type] + 1) * 500;
        if(state.money >= cost) {
            state.money -= cost; state.upgrades[type]++;
            ui.update(); ui.renderUpgrades(); game.save();
        } else ui.toast("UANG TIDAK CUKUP!");
    },
    save: () => localStorage.setItem('oceanRNG_v29', JSON.stringify(state)),
    reset: () => { if(confirm("Hapus semua data?")) { localStorage.clear(); location.reload(); } },
    loop: () => {
        if(isMoving) {
            let slowdown = 1 - (state.upgrades.slower * 0.06);
            let speed = isReeling ? (1.8 * 1.6 * slowdown) : 1.8;
            barPos += speed * barDir;
            if(barPos >= 100 || barPos <= 0) barDir *= -1;
            document.getElementById('pointer').style.left = barPos + '%';
        }
        requestAnimationFrame(game.loop);
    }
};

const ui = {
    startGame: () => {
        document.getElementById('main-menu').style.opacity = '0';
        setTimeout(() => { document.getElementById('main-menu').style.display = 'none'; isMoving = true; game.init(); }, 600);
    },
    tab: (id, btn) => {
        document.querySelectorAll('section').forEach(s => s.style.display = 'none');
        document.getElementById('tab-' + id).style.display = 'block';
        document.querySelectorAll('.sidebar .btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        if(id === 'quests') ui.renderQuests();
        if(id === 'upgrades') ui.renderUpgrades();
        if(id === 'shop') ui.renderShop();
        if(id === 'inventory') ui.renderInv();
        if(id === 'index') ui.renderIndex();
    },
    update: () => {
        document.getElementById('money').innerText = `üí∞ ${Math.floor(state.money).toLocaleString()}`;
        document.getElementById('inv-count').innerText = state.inventory.length;
        const rod = CONFIG.rods[state.equipped];
        document.getElementById('rod-display').innerText = rod.name;
        document.getElementById('rod-stats').innerText = `Boost Luck: +${rod.boost.toLocaleString()}%`;
        
        const w = CONFIG.weather[curW];
        document.getElementById('w-name').innerText = w.name;
        document.getElementById('w-stats').innerText = `Luck x${w.luck.toFixed(1)} | Money x${w.money.toFixed(1)}`;
        
        if(!isReeling) {
            const gz = document.getElementById('green-zone');
            gz.style.width = '20%'; gz.style.left = '40%';
        }
    },
    renderQuests: () => {
        const qData = [
            { n: 'Normal Fisher', c: state.qNormal, t: 500, d: 'Tangkap 500 ikan Normal/Rare' },
            { n: 'Secret Hunter', c: state.qSecret, t: 250, d: 'Tangkap 250 ikan Rank Secret' },
            { n: 'Ancient Legend', c: state.qAncient, t: 100, d: 'Tangkap 100 ikan Rank Ancient' }
        ];
        document.getElementById('quest-container').innerHTML = qData.map(q => `
            <div class="quest-box">
                <div style="display:flex; justify-content:space-between"><b>${q.n}</b> <span>${q.c}/${q.t}</span></div>
                <small style="color:#666">${q.d}</small>
                <div class="progress-container"><div class="progress-bar" style="width:${(q.c/q.t)*100}%"></div></div>
            </div>`).join('');
        
        const finished = state.qNormal >= 500 && state.qSecret >= 250 && state.qAncient >= 100;
        document.getElementById('claim-area').innerHTML = finished ? 
            `<button class="play-btn" onclick="ui.claimZenith()">${state.qClaimed ? 'ZENITH AKTIF' : 'KLAIM ZENITH LEGEND'}</button>` : 
            `<p style="text-align:center; color:#444">Misi Zenith Belum Selesai</p>`;
    },
    claimZenith: () => {
        if(!state.ownedRods.includes('zenith')) {
            state.ownedRods.push('zenith');
            state.qClaimed = true;
            ui.toast("ZENITH LEGEND ROD TERBUKA!");
            game.save(); ui.renderQuests();
        }
    },
    renderUpgrades: () => {
        document.getElementById('upgrade-container').innerHTML = `
            <div class="upgrade-box">
                <b>Slower Reel (Lv. ${state.upgrades.slower}/10)</b><br>
                <small>Memperlambat bar saat strike ikan langka.</small>
                <button class="btn" style="margin-top:10px" onclick="game.upgrade('slower')">üí∞ ${(state.upgrades.slower+1)*500}</button>
            </div>
            <div class="upgrade-box">
                <b>Bigger Reeler (Lv. ${state.upgrades.bigger}/15)</b><br>
                <small>Memperbesar area hijau minigame.</small>
                <button class="btn" style="margin-top:10px" onclick="game.upgrade('bigger')">üí∞ ${(state.upgrades.bigger+1)*500}</button>
            </div>`;
    },
    renderShop: () => {
        document.getElementById('shop-grid').innerHTML = Object.keys(CONFIG.rods).map(k => {
            const r = CONFIG.rods[k];
            const owned = state.ownedRods.includes(k);
            if(r.price === -1 && !owned) return '';
            return `<div class="item-box" style="border: 1px solid ${state.equipped===k?'var(--primary)':'#222'}">
                <b>${r.name}</b><br><small>Luck +${r.boost.toLocaleString()}%</small><br><br>
                <button class="btn" style="justify-content:center; font-size:10px" onclick="${owned?`ui.equip('${k}')` : `ui.buy('${k}')`}">
                ${state.equipped===k?'AKTIF':(owned?'PAKAI':'üí∞'+r.price.toLocaleString())}</button></div>`;
        }).join('');
    },
    renderInv: () => {
        document.getElementById('inv-grid').innerHTML = state.inventory.map(f => `<div class="item-box">${f.icon}<br><b>${f.name}</b></div>`).join('');
    },
    renderIndex: () => {
        document.getElementById('index-grid').innerHTML = CONFIG.fish.map(f => {
            const found = state.found.includes(f.name);
            return `<div class="item-box ${found?'':'locked'}">
                <div style="font-size:24px">${found?f.icon:'?'}</div>
                <div style="color:${found?CONFIG.ranks[f.r].color:'#444'}">${found?f.name:'???'}</div>
            </div>`;
        }).join('');
    },
    showResult: (fish) => {
        const res = document.getElementById('catch-result');
        if(!fish) res.innerHTML = `<h1 style="color:#444">LEPAS!</h1>`;
        else res.innerHTML = `<div style="animation: zoomIn 0.3s">
            <div style="font-size: 50px;">${fish.icon}</div>
            <h2 class="${fish.r==='ancient'?'txt-ancient':''}" style="color:${CONFIG.ranks[fish.r].color}">${fish.name}</h2>
            <small>${fish.r.toUpperCase()} | üí∞${fish.price}</small></div>`;
    },
    equip: (k) => { state.equipped = k; ui.update(); ui.renderShop(); game.save(); },
    buy: (k) => {
        if(state.money >= CONFIG.rods[k].price) {
            state.money -= CONFIG.rods[k].price; state.ownedRods.push(k);
            ui.toast("BERHASIL MEMBELI!"); ui.update(); ui.renderShop(); game.save();
        } else ui.toast("UANG TIDAK CUKUP!");
    },
    toast: (m) => {
        const t = document.getElementById('toast');
        t.innerText = m; t.style.opacity = 1;
        setTimeout(() => t.style.opacity = 0, 2000);
    }
};

window.addEventListener('keydown', (e) => { if(e.code === 'Space') game.handleAction(); });
game.init();
</script>
</body>
</html>